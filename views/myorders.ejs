<%- include('./partials/header') %>

<div class="w-full min-h-screen flex flex-col px-10 py-10 gap-8">
    <h1 class="text-3xl font-bold text-gray-700 mb-6">My Orders</h1>

    <% if (orders.length === 0) { %>
        <p class="text-2xl text-center text-blue-500 font-semibold">
            You have no orders yet.
        </p>
    <% } %>

    <% orders.forEach(order => { %>
        <div class="w-full bg-white shadow-md rounded-2xl p-6 border border-gray-200">
            <!-- Order Header -->
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 class="text-lg font-semibold text-gray-700">Order #<%= order._id %></h2>
                <h3 class="text-green-600 font-bold">₹ <%= order.totalCost %></h3>
            </div>

            <!-- Product List -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <% order.products.forEach(prod => { %>
                    <div class="flex gap-4 items-center border rounded-lg p-3">
                        <img class="h-20 w-20 object-contain rounded-md border"
                             src="data:<%= prod.mimetype %>;base64,<%= prod.image.toString('base64') %>"
                             alt="<%= prod.name %>">
                        <div>
                            <h4 class="font-medium text-gray-700"><%= prod.name %></h4>
                            <p class="text-sm text-gray-500">₹ <%= prod.price %></p>
                        </div>
                    </div>
                <% }) %>
            </div>

            <!-- Order Tracking -->
            <div class="mt-6">
                <h4 class="text-gray-700 font-semibold mb-2">Order Status</h4>
                <div class="flex items-center justify-between">
                    <% let steps = ["Ordered", "Shipped", "Out for Delivery", "Delivered"]; %>
                    <% steps.forEach((step, i) => { 
                        let active = (i === 0 && order.ordered) || 
                                     (i === 1 && order.shipped) || 
                                     (i === 2 && order.outforDelivery) || 
                                     (i === 3 && order.delivered);
                    %>
                        <div class="flex-1 flex items-center">
                            <div class="flex flex-col items-center">
                                <div class="w-8 h-8 flex items-center justify-center rounded-full 
                                    <%= active ? 'bg-green-500 text-white' : 'bg-gray-300 text-gray-600' %>">
                                    <%= i+1 %>
                                </div>
                                <p class="text-xs mt-1 <%= active ? 'text-green-600 font-semibold' : 'text-gray-500' %>">
                                    <%= step %>
                                </p>
                            </div>
                            <% if (i < steps.length - 1) { %>
                                <div class="flex-1 h-1 <%= (active || (i===0 && order.shipped) || (i===1 && order.outforDelivery) || (i===2 && order.delivered)) 
                                    ? 'bg-green-500' : 'bg-gray-300' %>"></div>
                            <% } %>
                        </div>
                    <% }) %>
                </div>
            </div>
        </div>
    <% }) %>
</div>

<%- include('./partials/footer') %>
